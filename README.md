# telegram_bot_inspector

Бот для проверки, по заданным правилам, сообщений в чате/канале
Используется с подключением к БД MySQL (используется модуль knex)
Используется словарь из проекта <https://github.com/bars38/Russian_ban_words>

## Для запуска бота необходимы переменные окружения env

PORT_DB  - порт для подключения БД MySQL
HOST_DB - хост для БД MySQL
USER_DB - имя пользователя БД MySQL
DATABASE_NAME - имя БД MySQL
PASSWORD_DB - пароль БД MySQL
TOKEN = токен telegram bot
SECRET = секретный вопрос, что бы получить права super_root_admin
LOGIN_OWNER - имя владельца данного bot
PATH_DICTIONARY = 'dictionary'  - имя папки со словарём
FILENAME_DICTIONARY = 'generalWords' - имя файла словаря

После первого запуска будет создан конфигурационный файл в каталоге conf, имя файла config.json
Все последующие запуски информация будет браться из него

## Логирование

В проекте используется модуль winston для логирования событий
Все логи хранятся в каталоге Log

## Уровни доступа пользователей

Всего три уровня доступа

1. admin - пользователь, имеет права на отправку сообщений в чат/канал без проверки по правилам
2. root_admin - пользователь, имеет все права "admin" и может добавлять чаты/каналы в для прослушивания ботом, добавлять/удалять новых "admin" для чата/канала. Изменять правила по чатам/каналам (только те, которые добавил сам)
3. super_root_admin - пользователь, имеет права "root_admin" и может добавлять/удалять новых root_admin

## Словари

Есть три словаря:

1. Словарь "General File" - это словарь взятый из проекта
 <https://github.com/bars38/Russian_ban_words>  Этот словарь одни на все чаты/каналы
2. Словарь "General DB" -  это словарь из БД MqSQL. Этот словарь одни на все чаты/каналы. Заполнять может только super_root_admin
3. Словарь "Personal DB" -  это словарь из БД MqSQL. Этот словарь персональный для каждого чата. Заполнять может root_admin

Функции для словарей (команда: /word):

* просмотреть
* добавить слово
* удалить слово

TODO не реализовано: добавление/удаление в Словарь "General File"

## Главное меню

Состоит:

* Список чатов - для просмотра список всех доступных чатов/каналов
* Добавить/Удалить чат - для добавления и удаления чатов/каналов
* Список админов - для просмотра список админов по доступным чатам/каналам
* Добавить/Удалить админа - для добавления и удаления админа в чате/канале
* Изменить правила чата - для просмотра и изменения правил по выбранному чату/каналу

## Правила для чатов/каналов

При  добавлении чата/канала все правила выключены
Каждое из правил включается отдельно

* Блокировка пользователя - пользователь нарушивший правило исключается из чата/канала
* Удаление ссылок - сообщение которое содержит ссылку (типа  'text_link' или 'hashtag' или  'url'  или 'email' или 'phone_number') будет удалено
* Уведомление администратора - уведомление root_admin о удаление сообщения
* Общий словарь БД - Словарь "General DB"
* Частный словарь БД - Словарь "Personal DB"
* Частный словарь из файла - Словарь "General File"

## Как стать получить права super_root_admin

Для получения права super_root_admin необходимо выполнить команды с секретным ключом (SECRET в env  переменных окружения)
    Пример: SECRET = "45RG54"
    команда: /45RG54

## Как стать получить права root_admin

Для получения права root_admin необходимо подключиться к данному боту, ввести команду /start
И запросить разрешение у владельца данного бота

## Как выдать/удалить права root_admin

Для добавления нового root_admin:

* От имени super_root_admin подключиться к боту
* ввести команду /choose_root_admin
* выбрать нужного пользователя

Для удаления root_admin:

* От имени super_root_admin подключиться к боту
* ввести команду /del_root_admin
* выбрать нужного пользователя

## Docker & Docker compose

Данного бота можно запустить в контейнере. Необходимые файлы уже есть в сборке.
Необходы переменные окружения env
